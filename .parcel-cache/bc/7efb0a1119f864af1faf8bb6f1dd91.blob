!function(){function e(e){return e&&e.__esModule?e.default:e}var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function i(e){return"string"==typeof e&&s.test(e)}for(var r,u,a=[],c=0;c<256;++c)a.push((c+256).toString(16).substr(1));var l=0,d=0;function p(e,t,n){var s=t&&n||0,c=t||new Array(16),p=(e=e||{}).node||r,m=void 0!==e.clockseq?e.clockseq:u;if(null==p||null==m){var h=e.random||(e.rng||o)();null==p&&(p=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==m&&(m=u=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:Date.now(),b=void 0!==e.nsecs?e.nsecs:d+1,v=f-l+(b-d)/1e4;if(v<0&&void 0===e.clockseq&&(m=m+1&16383),(v<0||f>l)&&void 0===e.nsecs&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,d=b,u=m;var g=(1e4*(268435455&(f+=122192928e5))+b)%4294967296;c[s++]=g>>>24&255,c[s++]=g>>>16&255,c[s++]=g>>>8&255,c[s++]=255&g;var x=f/4294967296*1e4&268435455;c[s++]=x>>>8&255,c[s++]=255&x,c[s++]=x>>>24&15|16,c[s++]=x>>>16&255,c[s++]=m>>>8|128,c[s++]=255&m;for(var y=0;y<6;++y)c[s+y]=p[y];return t||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase();if(!i(n))throw TypeError("Stringified UUID is invalid");return n}(c)}var m={};Object.defineProperty(m,"__esModule",{value:!0});class h{constructor(e,t){this.subscribe=e,this.unsubscribe=t}compose(e){return e(this)}map(e){return this.compose(function(e){return t=>new h((n=>{t.subscribe({next:t=>n.next(e(t)),complete:n.complete})}))}(e))}filter(e){return this.compose(function(e){return t=>new h((n=>{t.subscribe({next:t=>e(t)?n.next(t):void 0,complete:n.complete})}))}(e))}debounceTime(e){return this.compose(function(e){let t=null;return n=>new h((o=>{n.subscribe({next:n=>{t&&(clearTimeout(t),t=null),t=window.setTimeout((()=>o.next(n)),e)},complete:()=>{t&&window.clearTimeout(t),o.complete()}})}))}(e))}static fromEvent(e,t){const n=new h((o=>{t.addEventListener(e,o.next),n.unsubscribe=()=>t.removeEventListener(e,o.next)}));return n}}var f=h;m.default=f;var b=e(m);const v=()=>new Promise(requestAnimationFrame),g=e=>t=>new Promise((n=>{window.setTimeout((()=>n(t)),e)})),x=e=>t=>t===e,y=()=>{},w="disconnect",I="info",E="userTyping",D="userStoppedTyping",k="userConnected",C="userDisconnected",M="messageId",L="insert",S="delete";let T;var U;let q;var Q;(U=T||(T={})).Insert="insert",U.Delete="delete",U.Undo="undo",U.Redo="redo",(Q=q||(q={})).ALICE="alice",Q.BOB="bob";g(500);class R{mutationsQueue=[];content="";shouldUpdate=!1;constructor(e,t,n){this.author=e,this.conversationId=t,this.updateCallback=n,this.update()}enqueueMutation(e){this.shouldUpdate=!0,this.mutationsQueue.push({data:e,author:this.author,conversationId:this.conversationId,origin:this.origin})}update(){v().then(this.applyMutation.bind(this)).then(this.update.bind(this)).catch((e=>{console.error(e)}))}applyMutation(){if(this.mutationsQueue.length<1)return void(this.shouldUpdate&&this.updateCallback&&(this.updateCallback(this.getDocumentState().content),this.shouldUpdate=!1));const{data:e}=this.mutationsQueue[0];switch(e.type){case T.Insert:this.applyInsertion();break;case T.Delete:this.applyDeletion();break;case T.Undo:case T.Redo:}}applyInsertion(){const{content:e}=this,{data:t}=this.mutationsQueue.shift(),{index:n,text:o}=t;let s=e.substring(0,n)+o+e.substring(n);this.content=s}applyDeletion(){const{content:e}=this,{data:t}=this.mutationsQueue.shift(),{index:n,length:o}=t;let s=e.substring(0,n)+e.substring(n+o);this.content=s}createSnapshot(){}getDocumentState(){return{timestamp:new Date,content:this.content,mutations:this.mutationsQueue}}}const B=window.location.port?":"+window.location.port:"",V=`${window.location.hostname}${B}`,A=io.connect(V);let _=null,O=null,P=null;const $=new Map,j=x("Enter"),F=x("Backspace");let z=null;g(1e3);const G=g(2e3);g(250);A.on(I,(({id:e,connectedUsers:t})=>{O=e,z=new R(O,p(),(function(e){console.log(e),_.value=e})),t.filter((e=>e!==O)).forEach((e=>{Y({userId:e})}))}));const H=new b((e=>{A.on(k,e.next),A.on(k,e.complete)})),J=new b((e=>{A.on(C,e.next),A.on(C,e.complete)})),K=new b((e=>{A.on(L,e.next),A.on(w,e.complete)})),N=new b((e=>{A.on(E,e.next),A.on(E,e.complete)})),W=new b((e=>{A.on(D,e.next),A.on(D,e.complete)})),X=(new b((e=>{A.on(M,e.next)})),({from:e,text:t,index:n})=>{null!=t&&z.enqueueMutation({index:n,type:T.Insert,text:t})}),Y=({userId:e})=>{if($.has(e))return;const t=document.createElement("span");t.classList.add("user","u-float-right"),t.style.backgroundColor="#"+(16777215*Math.random()<<0).toString(16),$.set(e,t)},Z=({userId:e})=>{$.has(e)&&($.get(e).remove(),$.delete(e))},ee=({userId:e})=>{$.has(e)&&$.get(e).classList.add("typing")},te=({userId:e})=>{$.has(e)&&$.get(e).classList.remove("typing")};document.addEventListener("DOMContentLoaded",(()=>{P=document.getElementById("title"),_=document.getElementById("textInput");const e=b.fromEvent("keydown",_);v().then(G).then((()=>P.classList.add("u-fade"))),_.focus(),_.select(),H.subscribe({next:Y,complete:y}),J.subscribe({next:Z,complete:y});let t=null;e.filter((e=>1===e.key.length||j(e.key))).map((e=>(null===t&&(t=_.selectionStart),{e:e,id:p()}))).debounceTime(300).subscribe({next:({id:e,e:n})=>{n.preventDefault();const o=_.value.substring(t,_.selectionEnd);z.enqueueMutation({index:t,type:T.Insert,text:o}),(({index:e,text:t,id:n})=>{A.emit(L,{from:O,index:e,type:S,text:t,id:n})})({index:t,text:o,id:e}),t=null},complete:y});let n=null;e.filter((e=>F(e.code))).map((e=>(null===n&&(n=_.selectionStart),{e:e,id:p()}))).debounceTime(300).subscribe({next:({id:e,e:o})=>{o.preventDefault();const s=n-_.selectionEnd;z.enqueueMutation({index:t,type:T.Delete,length:s}),(({index:e,length:t,id:n})=>{A.emit(S,{from:O,index:e,type:S,length:t,id:n})})({index:t,length:s,id:e}),t=null},complete:y}),K.filter((({from:e})=>e!==O)).subscribe({next:X,complete:y}),N.subscribe({next:ee,complete:y}),W.subscribe({next:te,complete:y})}))}();
//# sourceMappingURL=index.HASH_REF_7b9c3643e4543d898105d9473fa9768e.js.map
