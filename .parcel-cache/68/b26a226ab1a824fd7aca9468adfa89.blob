!function(){function e(e){return e&&e.__esModule?e.default:e}var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function r(e){return"string"==typeof e&&s.test(e)}for(var i,c,u=[],a=0;a<256;++a)u.push((a+256).toString(16).substr(1));var l=0,d=0;function m(e,t,n){var s=t&&n||0,a=t||new Array(16),m=(e=e||{}).node||i,p=void 0!==e.clockseq?e.clockseq:c;if(null==m||null==p){var f=e.random||(e.rng||o)();null==m&&(m=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==p&&(p=c=16383&(f[6]<<8|f[7]))}var g=void 0!==e.msecs?e.msecs:Date.now(),w=void 0!==e.nsecs?e.nsecs:d+1,v=g-l+(w-d)/1e4;if(v<0&&void 0===e.clockseq&&(p=p+1&16383),(v<0||g>l)&&void 0===e.nsecs&&(w=0),w>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=g,d=w,c=p;var b=(1e4*(268435455&(g+=122192928e5))+w)%4294967296;a[s++]=b>>>24&255,a[s++]=b>>>16&255,a[s++]=b>>>8&255,a[s++]=255&b;var h=g/4294967296*1e4&268435455;a[s++]=h>>>8&255,a[s++]=255&h,a[s++]=h>>>24&15|16,a[s++]=h>>>16&255,a[s++]=p>>>8|128,a[s++]=255&p;for(var y=0;y<6;++y)a[s+y]=m[y];return t||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n}(a)}var p={};Object.defineProperty(p,"__esModule",{value:!0});class f{constructor(e,t){this.subscribe=e,this.unsubscribe=t}compose(e){return e(this)}map(e){return this.compose(function(e){return t=>new f((n=>{t.subscribe({next:t=>n.next(e(t)),complete:n.complete})}))}(e))}filter(e){return this.compose(function(e){return t=>new f((n=>{t.subscribe({next:t=>e(t)?n.next(t):void 0,complete:n.complete})}))}(e))}debounceTime(e){return this.compose(function(e){let t=null;return n=>new f((o=>{n.subscribe({next:n=>{t&&(clearTimeout(t),t=null),t=window.setTimeout((()=>o.next(n)),e)},complete:()=>{t&&window.clearTimeout(t),o.complete()}})}))}(e))}static fromEvent(e,t){const n=new f((o=>{t.addEventListener(e,o.next),n.unsubscribe=()=>t.removeEventListener(e,o.next)}));return n}}var g=f;p.default=g;var w=e(p);const v=()=>new Promise(requestAnimationFrame),b=e=>t=>new Promise((n=>{window.setTimeout((()=>n(t)),e)})),h=e=>t=>t===e,y=()=>{},x="disconnect",E="info",L="newMessage",I="userTyping",C="userStoppedTyping",T="userConnected",M="userDisconnected",k="messageId",S="insert",V=window.location.port?":"+window.location.port:"",D=`${window.location.hostname}${V}`,R=io.connect(D);let q=null,U=null,_=null;const j=new Map,A=h("Enter"),B=h("Backspace"),P=(b(1e3),b(2e3));b(250);R.on(E,(({id:e,connectedUsers:t})=>{U=e,t.filter((e=>e!==U)).forEach((e=>{K({userId:e})}))}));const $=new w((e=>{R.on(T,e.next),R.on(T,e.complete)})),O=new w((e=>{R.on(M,e.next),R.on(M,e.complete)})),F=new w((e=>{R.on(L,e.next),R.on(x,e.complete)})),z=new w((e=>{R.on(I,e.next),R.on(I,e.complete)})),G=new w((e=>{R.on(C,e.next),R.on(C,e.complete)})),H=(new w((e=>{R.on(k,e.next)})),({message:e,id:t,from:n})=>{if(!e)return;const o=U===n,s=document.createElement("div");s.textContent=e,s.classList.add("j-message"),s.id=t,o?s.classList.add("owner-self"):s.classList.add("owner-other"),v().then((()=>s.classList.add("visible"))),s.scrollIntoView()}),J=()=>{R.emit(I,{userId:U})},K=({userId:e})=>{if(j.has(e))return;const t=document.createElement("span");t.classList.add("user","u-float-right"),t.style.backgroundColor="#"+(16777215*Math.random()<<0).toString(16),j.set(e,t)},N=({userId:e})=>{j.has(e)&&(j.get(e).remove(),j.delete(e))},Q=({userId:e})=>{j.has(e)&&j.get(e).classList.add("typing")},W=({userId:e})=>{j.has(e)&&j.get(e).classList.remove("typing")};document.addEventListener("DOMContentLoaded",(()=>{_=document.getElementById("title"),q=document.getElementById("textInput");const e=w.fromEvent("keydown",q);v().then(P).then((()=>_.classList.add("u-fade"))),q.focus(),q.select(),$.subscribe({next:K,complete:y}),O.subscribe({next:N,complete:y});let t=null;e.filter((e=>!B(e.code))).map((e=>{const n=e.target;return null===t&&(t=e.target.selectionStart),{message:n.value.trim(),e:e,id:m()}})).debounceTime(300).subscribe({next:({message:e,id:n,e:o})=>{let s=o.target.selectionEnd;console.log(t,s),console.log(o.target.value.substring(t,s)),t=null,s=null,o.preventDefault(),(({message:e,id:t})=>{R.emit(S,{from:U,message:e,id:t})})({message:e,id:n})},complete:y}),e.filter((e=>!A(e.code))).subscribe({next:J,complete:y}),F.filter((({from:e})=>e!==U)).subscribe({next:H,complete:y}),z.subscribe({next:Q,complete:y}),G.subscribe({next:W,complete:y})}))}();
//# sourceMappingURL=index.HASH_REF_7b9c3643e4543d898105d9473fa9768e.js.map
