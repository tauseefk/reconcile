{"mappings":"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","sources":["./node_modules/@parcel/scope-hoisting/lib/helpers.js","./node_modules/uuid/dist/esm-browser/rng.js","./node_modules/uuid/dist/esm-browser/regex.js","./node_modules/uuid/dist/esm-browser/validate.js","./node_modules/uuid/dist/esm-browser/v1.js","./node_modules/uuid/dist/esm-browser/stringify.js","./node_modules/observable-stream/dist/index.js","./client/utils.ts","./events.ts","./client/Types.ts","./client/reconcile.ts","./client/messenger.ts"],"sourcesContent":["var $parcel$global =\n  typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n    ? self\n    : typeof window !== 'undefined'\n    ? window\n    : typeof global !== 'undefined'\n    ? global\n    : {};\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nfunction $parcel$defineInteropFlag(a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n}\n\nfunction $parcel$export(e, n, v) {\n  Object.defineProperty(e, n, {get: v, enumerable: true});\n}\n\nfunction $parcel$exportWildcard(dest, source) {\n  Object.keys(source).forEach(function(key) {\n    if (key === 'default' || key === '__esModule') {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function get() {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n}\n\nfunction $parcel$missingModule(name) {\n  var err = new Error(\"Cannot find module '\" + name + \"'\");\n  err.code = 'MODULE_NOT_FOUND';\n  throw err;\n}\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js'; // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || new Array(16);\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || rng)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || stringify(b);\n}\n\nexport default v1;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Stream {\n    constructor(subscribe, unsubscribe) {\n        this.subscribe = subscribe;\n        this.unsubscribe = unsubscribe;\n    }\n    compose(operator) {\n        return operator(this);\n    }\n    map(fn) {\n        return this.compose(_map(fn));\n    }\n    filter(fn) {\n        return this.compose(_filter(fn));\n    }\n    debounceTime(ms) {\n        return this.compose(debounceTime(ms));\n    }\n    static fromEvent(type, target) {\n        const _streamFromEvent = new Stream((observer) => {\n            target.addEventListener(type, observer.next);\n            _streamFromEvent.unsubscribe = () => target.removeEventListener(type, observer.next);\n        });\n        return _streamFromEvent;\n    }\n}\nexports.default = Stream;\nfunction _map(fn) {\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => observer.next(fn(data)),\n            complete: observer.complete,\n        });\n    });\n}\nconst noOp = () => { };\nfunction _filter(fn) {\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => (fn(data) ? observer.next(data) : noOp()),\n            complete: observer.complete,\n        });\n    });\n}\nfunction debounceTime(ms) {\n    let _timer = null;\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => {\n                if (_timer) {\n                    clearTimeout(_timer);\n                    _timer = null;\n                }\n                _timer = window.setTimeout(() => observer.next(data), ms);\n            },\n            complete: () => {\n                if (_timer)\n                    window.clearTimeout(_timer);\n                observer.complete();\n            },\n        });\n    });\n}\n","'use strict'\n\nconst promisifiedRAF = (): Promise<number> => new Promise(requestAnimationFrame)\n\nconst delay = (ms: number) => (res: any): Promise<any> =>\n  new Promise((resolve) => {\n    window.setTimeout(() => resolve(res), ms)\n  })\n\nconst debounce = (fn: Function, ms: number): Function => {\n  let timer: number\n  return (...args: any[]): void => {\n    if (timer) clearTimeout(timer)\n    timer = window.setTimeout(fn.bind(null, ...args), ms)\n  }\n}\n\nconst getRandomColor = (): string =>\n  '#' + ((Math.random() * 16777215) << 0).toString(16)\n\nconst branchInto = (a: Function, b: Function): Function => (\n  condition: boolean,\n): Function => (_: any) =>\n  condition ? Promise.resolve(a(_)) : Promise.resolve(b(_))\n\nconst keyIs = (key: string): Function => (code: string): boolean => code === key\n\nconst takeContinuousN = (n: number, ms: number = 300) => {\n  let _count: number = 0\n  let _resetCountTimer: number | undefined\n\n  return (): boolean => {\n    if (++_count >= n) {\n      _count = 0\n      window.clearTimeout(_resetCountTimer)\n      return true\n    }\n\n    if (_resetCountTimer) window.clearTimeout(_resetCountTimer)\n    _resetCountTimer = window.setTimeout(() => {\n      _count = 0\n    }, ms)\n    return false\n  }\n}\n\nconst noOp = () => {}\n\nexport {\n  promisifiedRAF,\n  delay,\n  debounce,\n  getRandomColor,\n  branchInto,\n  keyIs,\n  takeContinuousN,\n  noOp,\n}\n","export const events = {\n  CONNECTION: 'connection',\n  DISCONNECT: 'disconnect',\n  INFO: 'info',\n  NEW_MESSAGE: 'newMessage',\n  TYPING: 'userTyping',\n  STOPPED_TYPING: 'userStoppedTyping',\n  USER_CONNECTED: 'userConnected',\n  USER_DISCONNETED: 'userDisconnected',\n  MESSAGE_ID: 'messageId',\n  EMPHASIZE_MESSAGE: 'emphasizeMessage',\n  INSERT: 'insert',\n  DELETE: 'delete',\n  undo: 'undo',\n  redo: 'redo',\n};\n","export enum OPERATIONTYPE {\n  Insert = 'insert',\n  Delete = 'delete',\n  Undo = 'undo',\n  Redo = 'redo',\n}\n\nexport enum AUTHORS {\n  ALICE = 'alice',\n  BOB = 'bob',\n}\n\nexport type Origin = {\n  [value in AUTHORS]: number;\n};\n\nexport interface IMutationData {\n  index: number;\n  length?: number;\n  text?: string;\n  type: OPERATIONTYPE;\n}\n\nexport interface IMutation {\n  author: AUTHORS;\n  conversationId: string;\n  data: IMutationData;\n  origin: Origin; // Should we just use origin to sort, or use timestamp as well?\n}\n","import { delay, promisifiedRAF } from './utils';\nimport {\n  AUTHORS,\n  IMutation,\n  IMutationData,\n  OPERATIONTYPE,\n  Origin,\n} from './Types';\n\nexport const ping = () => {};\nconst delayLong = delay(2000);\n\n// {\n//   \"author\": \"alice | bob\",\n//   \"conversationId\": \"string\",\n//   \"data\": {\n//     \"index\": \"number\",\n//     \"length\": \"number | undefined\",\n//     \"text\": \"string | undefined\",\n//     \"type\": \"insert | delete\"\n//   },\n//   \"origin\": {\n//     \"alice\": \"integer\",\n//     \"bob\": \"integer\"\n//   }\n// }\n\ninterface ISnapShot {\n  timestamp: Date;\n  content: string; // assume single string for now\n  mutations: IMutation[];\n}\n\nexport class Reconcile {\n  private mutationsQueue: IMutation[] = [];\n  private content: string = \"\";\n  private origin: Origin;\n  private author: AUTHORS;\n  private conversationId: string;\n\n  constructor(author: AUTHORS, conversationId: string) {\n    this.author = author;\n    this.conversationId = conversationId;\n  }\n\n  enqueueMutation(data: IMutationData) {\n    this.mutationsQueue.push({\n      data,\n      author: this.author,\n      conversationId: this.conversationId,\n      origin: this.origin,\n    });\n  }\n\n  update() {\n    promisifiedRAF()\n      .then(this.applyMutation.bind(this))\n      .then(this.update.bind(this))\n      .catch((e) => {\n        console.error(e);\n      });\n  }\n\n  private applyMutation() {\n    if (this.mutationsQueue.length < 1) {\n      throw new Error('Mutations queue empty');\n    }\n\n    const { data } = this.mutationsQueue[0];\n\n    switch (data.type) {\n      case OPERATIONTYPE.Insert:\n        this.applyInsertion();\n        break;\n      case OPERATIONTYPE.Delete:\n        this.applyDeletion();\n        break;\n      case OPERATIONTYPE.Undo:\n        break;\n      case OPERATIONTYPE.Redo:\n        break;\n    }\n  }\n\n  private applyInsertion() {\n    const { content } = this;\n    const { data } = this.mutationsQueue.shift();\n    const { index, text } = data;\n\n    let updatedContent =\n      content.substring(0, index + 1) + text + content.substring(index);\n    this.content = updatedContent;\n  }\n\n  private applyDeletion() {\n    const { content } = this;\n    const { data } = this.mutationsQueue.shift();\n    const { index, length } = data;\n\n    let updatedContent =\n      content.substring(0, index) + content.substring(index + length);\n    this.content = updatedContent;\n  }\n\n  private createSnapshot() {}\n\n  // only send on initialize for each user\n  getDocumentState(): ISnapShot {\n    return {\n      timestamp: new Date(),\n      content: this.content,\n      mutations: this.mutationsQueue,\n    };\n  }\n}\n","'use strict';\n\nimport { v1 } from 'uuid';\nimport Stream from 'observable-stream';\nimport { delay, keyIs, getRandomColor, promisifiedRAF, noOp } from './utils';\nimport { events } from '../events';\n\nconst port = window.location.port ? ':' + window.location.port : '';\nconst host = `${window.location.hostname}${port}`;\nconst socket = io.connect(host);\nlet textInputEl: HTMLTextAreaElement = null;\nlet userId = null;\nlet titleEl = null;\nconst activeUsers = new Map();\nimport { Reconcile } from './reconcile';\nimport { AUTHORS, OPERATIONTYPE } from './Types';\n\nconst keyIsEnter = keyIs('Enter');\nconst keyIsDelete = keyIs('Backspace');\nlet ReconcileAPI: Reconcile = null;\n\nconst delayShort = delay(1000);\nconst delayLong = delay(2000);\nconst delayTiny = delay(250);\n\nsocket.on(events.INFO, ({ id, connectedUsers }) => {\n  userId = id;\n  connectedUsers\n    .filter((user) => user !== userId)\n    .forEach((user) => {\n      addToActiveUsers({ userId: user });\n    });\n});\n\ntype Connection = { userId: string };\nconst $userConnection = new Stream<Connection>((observer) => {\n  socket.on(events.USER_CONNECTED, observer.next);\n  socket.on(events.USER_CONNECTED, observer.complete);\n});\n\nconst $userDisconnection = new Stream<Connection>((observer) => {\n  socket.on(events.USER_DISCONNETED, observer.next);\n  socket.on(events.USER_DISCONNETED, observer.complete);\n});\n\ntype EditorInsert = { author: string; text: string; index: number };\nconst $editorInsert = new Stream<EditorInsert>((observer) => {\n  socket.on(events.INSERT, observer.next);\n  socket.on(events.DISCONNECT, observer.complete);\n});\n\nconst $userTypingStart = new Stream((observer) => {\n  socket.on(events.TYPING, observer.next);\n  socket.on(events.TYPING, observer.complete);\n});\n\nconst $userTypingStop = new Stream((observer) => {\n  socket.on(events.STOPPED_TYPING, observer.next);\n  socket.on(events.STOPPED_TYPING, observer.complete);\n});\n\nconst $messageId = new Stream((observer) => {\n  socket.on(events.MESSAGE_ID, observer.next);\n});\n\n/**\n * Adds the message to the chat, and scrolls it into view.\n * Just DOM operations.\n * @param {object} { message, id }\n * @param {boolean} isOwn\n */\nconst updateEditor = ({ author, text }: EditorInsert) => {\n  if (text === undefined || text === null) return;\n  const isOwn = userId === author;\n\n  ReconcileAPI.update();\n  textInputEl.textContent = ReconcileAPI.getDocumentState().content;\n};\n\nconst emitTyping = () => {\n  socket.emit(events.TYPING, { userId });\n};\n\nconst emitInsertEvent = ({ index, type, text, id }) => {\n  socket.emit(events.INSERT, {\n    from: userId,\n    index,\n    type,\n    text,\n    id,\n  });\n};\n\nconst addToActiveUsers = ({ userId }) => {\n  if (activeUsers.has(userId)) return;\n\n  const userEl = document.createElement('span');\n  userEl.classList.add('user', 'u-float-right');\n  userEl.style.backgroundColor = getRandomColor();\n\n  activeUsers.set(userId, userEl);\n};\n\nconst removeFromActiveUsers = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).remove();\n  activeUsers.delete(userId);\n};\n\nconst startTyping = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).classList.add('typing');\n};\n\nconst stopTyping = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).classList.remove('typing');\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  titleEl = document.getElementById('title');\n  textInputEl = document.getElementById('textInput') as HTMLTextAreaElement;\n  ReconcileAPI = new Reconcile(AUTHORS.ALICE, v1());\n\n  const $textInput = Stream.fromEvent(\n    'keydown',\n    textInputEl,\n  ) as Stream<KeyboardEvent>;\n\n  promisifiedRAF()\n    .then(delayLong)\n    .then(() => titleEl.classList.add('u-fade'));\n\n  textInputEl.focus();\n  textInputEl.select();\n\n  $userConnection.subscribe({\n    next: addToActiveUsers,\n    complete: noOp,\n  });\n\n  $userDisconnection.subscribe({\n    next: removeFromActiveUsers,\n    complete: noOp,\n  });\n\n  // insertion events\n  let startPos = null;\n  $textInput\n    .filter((e) => !keyIsDelete(e.code))\n    .map((e) => {\n      const target = e.target as HTMLTextAreaElement;\n      if (startPos === null) {\n        // @ts-ignore\n        startPos = e.target.selectionStart;\n      }\n      return {\n        text: target.value.trim(),\n        e,\n        id: v1(),\n      };\n    })\n    .debounceTime(300) // only fire update events after this time\n    .subscribe({\n      next: ({ id, e }) => {\n        e.preventDefault();\n\n        // @ts-ignore\n        let endPos = e.target.selectionEnd;\n        // @ts-ignore\n        const stringToInsert = e.target.value.substring(startPos, endPos);\n\n        startPos = null;\n        endPos = null;\n        ReconcileAPI.enqueueMutation({\n          index: startPos,\n          type: OPERATIONTYPE.Insert,\n          text: stringToInsert,\n        });\n\n        emitInsertEvent({\n          index: startPos,\n          type: OPERATIONTYPE.Insert,\n          text: stringToInsert,\n          id,\n        });\n      },\n      complete: noOp,\n    });\n\n  $textInput\n    .filter((e) => !keyIsEnter(e.code))\n    .subscribe({\n      next: emitTyping,\n      complete: noOp,\n    });\n\n  $editorInsert\n    .filter(({ author }) => author !== userId)\n    .subscribe({\n      next: updateEditor,\n      complete: noOp,\n    });\n\n  $userTypingStart.subscribe({\n    next: startTyping,\n    complete: noOp,\n  });\n\n  $userTypingStop.subscribe({\n    next: stopTyping,\n    complete: noOp,\n  });\n});\n"],"names":["$parcel$interopDefault","a","__esModule","default","$9cdf19e69c867c9613f8a5f54a7bcc18$var$getRandomValues","$9cdf19e69c867c9613f8a5f54a7bcc18$var$rnds8","Uint8Array","$9cdf19e69c867c9613f8a5f54a7bcc18$export$default","crypto","getRandomValues","bind","msCrypto","Error","$b268ae3034f6495bfc51b97df46e9f9d$export$default","uuid","$e7fd8a45fba05150bca17eaec76d3f37$export$default","test","$0ccf622f17bacc0947bc60ed76028ef8$var$_nodeId","$0ccf622f17bacc0947bc60ed76028ef8$var$_clockseq","$2ab850b7b58ac405e6af10d2ec717a53$var$byteToHex","$2ab850b7b58ac405e6af10d2ec717a53$var$i","push","toString","substr","$0ccf622f17bacc0947bc60ed76028ef8$var$_lastMSecs","$0ccf622f17bacc0947bc60ed76028ef8$var$_lastNSecs","$0ccf622f17bacc0947bc60ed76028ef8$export$default","options","buf","offset","i","b","Array","node","clockseq","undefined","seedBytes","random","rng","msecs","Date","now","nsecs","dt","tl","tmh","n","arr","arguments","length","toLowerCase","TypeError","Object","defineProperty","value","$9ebb1528925c550400235b9f7fac119a$var$Stream","constructor","subscribe","unsubscribe","this","compose","operator","map","fn","stream","observer","next","data","complete","$9ebb1528925c550400235b9f7fac119a$var$_map","filter","$9ebb1528925c550400235b9f7fac119a$var$noOp","$9ebb1528925c550400235b9f7fac119a$var$_filter","debounceTime","ms","_timer","clearTimeout","window","setTimeout","$9ebb1528925c550400235b9f7fac119a$var$debounceTime","type","target","_streamFromEvent","addEventListener","removeEventListener","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$promisifiedRAF","Promise","requestAnimationFrame","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$delay","res","resolve","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$keyIs","key","code","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$noOp","$44743fe7bba9271ee62b9170efaf09f5$export$events","$b6264d05482dbe4ada3acf689b82e0e7$export$OPERATIONTYPE","OPERATIONTYPE","$b6264d05482dbe4ada3acf689b82e0e7$export$AUTHORS","AUTHORS","$905f76653d4008bb05e50a7a8fe24946$var$delayLong","$905f76653d4008bb05e50a7a8fe24946$export$Reconcile","mutationsQueue","content","author","conversationId","enqueueMutation","origin","update","then","applyMutation","catch","e","console","error","Insert","applyInsertion","Delete","applyDeletion","Undo","Redo","shift","index","text","updatedContent","substring","createSnapshot","getDocumentState","timestamp","mutations","$da5e51a02dea60081015c093ccbc4749$var$port","location","port","$da5e51a02dea60081015c093ccbc4749$var$host","hostname","$da5e51a02dea60081015c093ccbc4749$var$socket","io","connect","$da5e51a02dea60081015c093ccbc4749$var$textInputEl","$da5e51a02dea60081015c093ccbc4749$var$userId","$da5e51a02dea60081015c093ccbc4749$var$titleEl","$da5e51a02dea60081015c093ccbc4749$var$activeUsers","Map","$da5e51a02dea60081015c093ccbc4749$var$keyIsEnter","$da5e51a02dea60081015c093ccbc4749$var$keyIsDelete","$da5e51a02dea60081015c093ccbc4749$var$ReconcileAPI","$da5e51a02dea60081015c093ccbc4749$var$delayShort","$da5e51a02dea60081015c093ccbc4749$var$delayLong","$da5e51a02dea60081015c093ccbc4749$var$delayTiny","on","id","connectedUsers","user","forEach","$da5e51a02dea60081015c093ccbc4749$var$addToActiveUsers","userId","$da5e51a02dea60081015c093ccbc4749$var$$userConnection","$da5e51a02dea60081015c093ccbc4749$var$$userDisconnection","$da5e51a02dea60081015c093ccbc4749$var$$editorInsert","$da5e51a02dea60081015c093ccbc4749$var$$userTypingStart","$da5e51a02dea60081015c093ccbc4749$var$$userTypingStop","$da5e51a02dea60081015c093ccbc4749$var$updateEditor","$da5e51a02dea60081015c093ccbc4749$var$$messageId","textContent","$da5e51a02dea60081015c093ccbc4749$var$emitTyping","emit","TYPING","has","userEl","document","createElement","classList","add","style","backgroundColor","Math","set","$da5e51a02dea60081015c093ccbc4749$var$removeFromActiveUsers","get","remove","delete","$da5e51a02dea60081015c093ccbc4749$var$startTyping","$da5e51a02dea60081015c093ccbc4749$var$stopTyping","getElementById","ALICE","$textInput","fromEvent","focus","select","startPos","selectionStart","trim","preventDefault","endPos","selectionEnd","stringToInsert","INSERT","from","$da5e51a02dea60081015c093ccbc4749$var$emitInsertEvent"],"version":3,"file":"index.HASH_REF_7b9c3643e4543d898105d9473fa9768e.js.map"}