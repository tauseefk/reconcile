{"mappings":"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","sources":["./node_modules/@parcel/scope-hoisting/lib/helpers.js","./node_modules/uuid/dist/esm-browser/rng.js","./node_modules/uuid/dist/esm-browser/regex.js","./node_modules/uuid/dist/esm-browser/validate.js","./node_modules/uuid/dist/esm-browser/v1.js","./node_modules/uuid/dist/esm-browser/stringify.js","./node_modules/observable-stream/dist/index.js","./client/utils.ts","./events.ts","./client/messenger.ts"],"sourcesContent":["var $parcel$global =\n  typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n    ? self\n    : typeof window !== 'undefined'\n    ? window\n    : typeof global !== 'undefined'\n    ? global\n    : {};\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nfunction $parcel$defineInteropFlag(a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n}\n\nfunction $parcel$export(e, n, v) {\n  Object.defineProperty(e, n, {get: v, enumerable: true});\n}\n\nfunction $parcel$exportWildcard(dest, source) {\n  Object.keys(source).forEach(function(key) {\n    if (key === 'default' || key === '__esModule') {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function get() {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n}\n\nfunction $parcel$missingModule(name) {\n  var err = new Error(\"Cannot find module '\" + name + \"'\");\n  err.code = 'MODULE_NOT_FOUND';\n  throw err;\n}\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js'; // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || new Array(16);\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || rng)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || stringify(b);\n}\n\nexport default v1;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Stream {\n    constructor(subscribe, unsubscribe) {\n        this.subscribe = subscribe;\n        this.unsubscribe = unsubscribe;\n    }\n    compose(operator) {\n        return operator(this);\n    }\n    map(fn) {\n        return this.compose(_map(fn));\n    }\n    filter(fn) {\n        return this.compose(_filter(fn));\n    }\n    debounceTime(ms) {\n        return this.compose(debounceTime(ms));\n    }\n    static fromEvent(type, target) {\n        const _streamFromEvent = new Stream((observer) => {\n            target.addEventListener(type, observer.next);\n            _streamFromEvent.unsubscribe = () => target.removeEventListener(type, observer.next);\n        });\n        return _streamFromEvent;\n    }\n}\nexports.default = Stream;\nfunction _map(fn) {\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => observer.next(fn(data)),\n            complete: observer.complete,\n        });\n    });\n}\nconst noOp = () => { };\nfunction _filter(fn) {\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => (fn(data) ? observer.next(data) : noOp()),\n            complete: observer.complete,\n        });\n    });\n}\nfunction debounceTime(ms) {\n    let _timer = null;\n    return (stream) => new Stream((observer) => {\n        stream.subscribe({\n            next: (data) => {\n                if (_timer) {\n                    clearTimeout(_timer);\n                    _timer = null;\n                }\n                _timer = window.setTimeout(() => observer.next(data), ms);\n            },\n            complete: () => {\n                if (_timer)\n                    window.clearTimeout(_timer);\n                observer.complete();\n            },\n        });\n    });\n}\n","'use strict'\n\nconst promisifiedRAF = (): Promise<number> => new Promise(requestAnimationFrame)\n\nconst delay = (ms: number) => (res: any): Promise<any> =>\n  new Promise((resolve) => {\n    window.setTimeout(() => resolve(res), ms)\n  })\n\nconst debounce = (fn: Function, ms: number): Function => {\n  let timer: number\n  return (...args: any[]): void => {\n    if (timer) clearTimeout(timer)\n    timer = window.setTimeout(fn.bind(null, ...args), ms)\n  }\n}\n\nconst getRandomColor = (): string =>\n  '#' + ((Math.random() * 16777215) << 0).toString(16)\n\nconst branchInto = (a: Function, b: Function): Function => (\n  condition: boolean,\n): Function => (_: any) =>\n  condition ? Promise.resolve(a(_)) : Promise.resolve(b(_))\n\nconst keyIs = (key: string): Function => (code: string): boolean => code === key\n\nconst takeContinuousN = (n: number, ms: number = 300) => {\n  let _count: number = 0\n  let _resetCountTimer: number | undefined\n\n  return (): boolean => {\n    if (++_count >= n) {\n      _count = 0\n      window.clearTimeout(_resetCountTimer)\n      return true\n    }\n\n    if (_resetCountTimer) window.clearTimeout(_resetCountTimer)\n    _resetCountTimer = window.setTimeout(() => {\n      _count = 0\n    }, ms)\n    return false\n  }\n}\n\nconst noOp = () => {}\n\nexport {\n  promisifiedRAF,\n  delay,\n  debounce,\n  getRandomColor,\n  branchInto,\n  keyIs,\n  takeContinuousN,\n  noOp,\n}\n","export const events = {\n  CONNECTION: 'connection',\n  DISCONNECT: 'disconnect',\n  INFO: 'info',\n  NEW_MESSAGE: 'newMessage',\n  TYPING: 'userTyping',\n  STOPPED_TYPING: 'userStoppedTyping',\n  USER_CONNECTED: 'userConnected',\n  USER_DISCONNETED: 'userDisconnected',\n  MESSAGE_ID: 'messageId',\n  EMPHASIZE_MESSAGE: 'emphasizeMessage',\n  INSERT: 'insert',\n  DELETE: 'delete',\n  undo: 'undo',\n  redo: 'redo',\n};\n","'use strict';\n\nimport { v1 } from 'uuid';\nimport Stream from 'observable-stream';\nimport {\n  delay,\n  keyIs,\n  getRandomColor,\n  promisifiedRAF,\n  noOp,\n} from './utils';\nimport { events } from '../events';\n\nconst port = window.location.port ? ':' + window.location.port : '';\nconst host = `${window.location.hostname}${port}`;\nconst socket = io.connect(host);\nlet textInputEl = null;\nlet userId = null;\nlet titleEl = null;\nconst activeUsers = new Map();\n\nconst keyIsEnter = keyIs('Enter');\nconst keyIsDelete = keyIs('Backspace');\n\nconst delayShort = delay(1000);\nconst delayLong = delay(2000);\nconst delayTiny = delay(250);\n\nsocket.on(events.INFO, ({ id, connectedUsers }) => {\n  userId = id;\n  connectedUsers\n    .filter((user) => user !== userId)\n    .forEach((user) => {\n      addToActiveUsers({ userId: user });\n    });\n});\n\ntype Connection = { userId: string };\nconst $userConnection = new Stream<Connection>((observer) => {\n  socket.on(events.USER_CONNECTED, observer.next);\n  socket.on(events.USER_CONNECTED, observer.complete);\n});\n\nconst $userDisconnection = new Stream<Connection>((observer) => {\n  socket.on(events.USER_DISCONNETED, observer.next);\n  socket.on(events.USER_DISCONNETED, observer.complete);\n});\n\ntype Message = { id: string; message: string; from: string };\nconst $messages = new Stream<Message>((observer) => {\n  socket.on(events.NEW_MESSAGE, observer.next);\n  socket.on(events.DISCONNECT, observer.complete);\n});\n\nconst $userTypingStart = new Stream((observer) => {\n  socket.on(events.TYPING, observer.next);\n  socket.on(events.TYPING, observer.complete);\n});\n\nconst $userTypingStop = new Stream((observer) => {\n  socket.on(events.STOPPED_TYPING, observer.next);\n  socket.on(events.STOPPED_TYPING, observer.complete);\n});\n\nconst $messageId = new Stream((observer) => {\n  socket.on(events.MESSAGE_ID, observer.next);\n});\n\n/**\n * Adds the message to the chat, and scrolls it into view.\n * Just DOM operations.\n * @param {object} { message, id }\n * @param {boolean} isOwn\n */\nconst addMessageToChat = ({ message, id, from }: Message) => {\n  if (!message) return;\n  const isOwn = userId === from;\n\n  const mEl = document.createElement('div');\n  mEl.textContent = message;\n  mEl.classList.add('j-message');\n  mEl.id = id;\n  isOwn ? mEl.classList.add('owner-self') : mEl.classList.add('owner-other');\n  promisifiedRAF().then(() => mEl.classList.add('visible'));\n  mEl.scrollIntoView();\n};\n\nconst emitTyping = () => {\n  socket.emit(events.TYPING, { userId });\n};\n\nconst emitNewMessage = ({ message, id }) => {\n  socket.emit(events.INSERT, {\n    from: userId,\n    message,\n    id,\n  });\n};\n\nconst addToActiveUsers = ({ userId }) => {\n  if (activeUsers.has(userId)) return;\n\n  const userEl = document.createElement('span');\n  userEl.classList.add('user', 'u-float-right');\n  userEl.style.backgroundColor = getRandomColor();\n\n  activeUsers.set(userId, userEl);\n};\n\nconst removeFromActiveUsers = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).remove();\n  activeUsers.delete(userId);\n};\n\nconst startTyping = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).classList.add('typing');\n};\n\nconst stopTyping = ({ userId }) => {\n  if (!activeUsers.has(userId)) return;\n\n  activeUsers.get(userId).classList.remove('typing');\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  titleEl = document.getElementById('title');\n  textInputEl = document.getElementById('textInput');\n\n  const $textInput = Stream.fromEvent(\n    'keydown',\n    textInputEl,\n  ) as Stream<KeyboardEvent>;\n\n  promisifiedRAF()\n    .then(delayLong)\n    .then(() => titleEl.classList.add('u-fade'));\n\n  textInputEl.focus();\n  textInputEl.select();\n\n  $userConnection.subscribe({\n    next: addToActiveUsers,\n    complete: noOp,\n  });\n\n  $userDisconnection.subscribe({\n    next: removeFromActiveUsers,\n    complete: noOp,\n  });\n\n  let startPos = null\n  $textInput\n    .filter((e) => !keyIsDelete(e.code))\n    .map((e) => {\n      const target = e.target as HTMLTextAreaElement;\n      if (startPos === null) {\n        // @ts-ignore\n        startPos = e.target.selectionStart;\n      }\n      return {\n        message: target.value.trim(),\n        e,\n        id: v1(),\n      };\n    })\n    .debounceTime(300) // only fire update events after this time\n    .subscribe({\n      next: ({ message, id, e }) => {\n        // @ts-ignore\n        let endPos = e.target.selectionEnd;\n        console.log(startPos, endPos); // assuming no selection\n        // @ts-ignore\n        console.log(e.target.value.substring(startPos, endPos));\n        startPos = null; endPos = null;\n\n        e.preventDefault();\n        emitNewMessage({ message, id });\n      },\n      complete: noOp,\n    });\n\n  $textInput\n    .filter((e) => !keyIsEnter(e.code))\n    .subscribe({\n      next: emitTyping,\n      complete: noOp,\n    });\n\n  $messages\n    .filter(({ from }) => from !== userId)\n    .subscribe({\n      next: addMessageToChat,\n      complete: noOp,\n    });\n\n  $userTypingStart.subscribe({\n    next: startTyping,\n    complete: noOp,\n  });\n\n  $userTypingStop.subscribe({\n    next: stopTyping,\n    complete: noOp,\n  });\n});\n"],"names":["$parcel$interopDefault","a","__esModule","default","$9cdf19e69c867c9613f8a5f54a7bcc18$var$getRandomValues","$9cdf19e69c867c9613f8a5f54a7bcc18$var$rnds8","Uint8Array","$9cdf19e69c867c9613f8a5f54a7bcc18$export$default","crypto","getRandomValues","bind","msCrypto","Error","$b268ae3034f6495bfc51b97df46e9f9d$export$default","uuid","$e7fd8a45fba05150bca17eaec76d3f37$export$default","test","$0ccf622f17bacc0947bc60ed76028ef8$var$_nodeId","$0ccf622f17bacc0947bc60ed76028ef8$var$_clockseq","$2ab850b7b58ac405e6af10d2ec717a53$var$byteToHex","$2ab850b7b58ac405e6af10d2ec717a53$var$i","push","toString","substr","$0ccf622f17bacc0947bc60ed76028ef8$var$_lastMSecs","$0ccf622f17bacc0947bc60ed76028ef8$var$_lastNSecs","$0ccf622f17bacc0947bc60ed76028ef8$export$default","options","buf","offset","i","b","Array","node","clockseq","undefined","seedBytes","random","rng","msecs","Date","now","nsecs","dt","tl","tmh","n","arr","arguments","length","toLowerCase","TypeError","Object","defineProperty","value","$9ebb1528925c550400235b9f7fac119a$var$Stream","constructor","subscribe","unsubscribe","this","compose","operator","map","fn","stream","observer","next","data","complete","$9ebb1528925c550400235b9f7fac119a$var$_map","filter","$9ebb1528925c550400235b9f7fac119a$var$noOp","$9ebb1528925c550400235b9f7fac119a$var$_filter","debounceTime","ms","_timer","clearTimeout","window","setTimeout","$9ebb1528925c550400235b9f7fac119a$var$debounceTime","type","target","_streamFromEvent","addEventListener","removeEventListener","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$promisifiedRAF","Promise","requestAnimationFrame","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$delay","res","resolve","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$keyIs","key","code","$9ed30fb2cc237e57f4ead3adb1e4f6ac$export$noOp","$44743fe7bba9271ee62b9170efaf09f5$export$events","$da5e51a02dea60081015c093ccbc4749$var$port","location","port","$da5e51a02dea60081015c093ccbc4749$var$host","hostname","$da5e51a02dea60081015c093ccbc4749$var$socket","io","connect","$da5e51a02dea60081015c093ccbc4749$var$textInputEl","$da5e51a02dea60081015c093ccbc4749$var$userId","$da5e51a02dea60081015c093ccbc4749$var$titleEl","$da5e51a02dea60081015c093ccbc4749$var$activeUsers","Map","$da5e51a02dea60081015c093ccbc4749$var$keyIsEnter","$da5e51a02dea60081015c093ccbc4749$var$keyIsDelete","$da5e51a02dea60081015c093ccbc4749$var$delayLong","$da5e51a02dea60081015c093ccbc4749$var$delayShort","$da5e51a02dea60081015c093ccbc4749$var$delayTiny","on","id","connectedUsers","user","forEach","$da5e51a02dea60081015c093ccbc4749$var$addToActiveUsers","userId","$da5e51a02dea60081015c093ccbc4749$var$$userConnection","$da5e51a02dea60081015c093ccbc4749$var$$userDisconnection","$da5e51a02dea60081015c093ccbc4749$var$$messages","$da5e51a02dea60081015c093ccbc4749$var$$userTypingStart","$da5e51a02dea60081015c093ccbc4749$var$$userTypingStop","$da5e51a02dea60081015c093ccbc4749$var$addMessageToChat","$da5e51a02dea60081015c093ccbc4749$var$$messageId","message","from","isOwn","mEl","document","createElement","textContent","classList","add","then","scrollIntoView","$da5e51a02dea60081015c093ccbc4749$var$emitTyping","emit","TYPING","has","userEl","style","backgroundColor","Math","set","$da5e51a02dea60081015c093ccbc4749$var$removeFromActiveUsers","get","remove","delete","$da5e51a02dea60081015c093ccbc4749$var$startTyping","$da5e51a02dea60081015c093ccbc4749$var$stopTyping","getElementById","$textInput","fromEvent","focus","select","startPos","e","selectionStart","trim","endPos","selectionEnd","console","log","substring","preventDefault","INSERT","$da5e51a02dea60081015c093ccbc4749$var$emitNewMessage"],"version":3,"file":"index.HASH_REF_7b9c3643e4543d898105d9473fa9768e.js.map"}